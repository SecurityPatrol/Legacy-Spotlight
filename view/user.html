<html lang="ja">

    <head>
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
        <meta http-equiv="pragma" content="no-cache">
        <meta http-equiv="cache-control" content="no-cache">
        <meta http-equiv="content-style-type" content="text/css">
        <meta http-equiv="content-script-type" content="text/javascript">
        <link rel="stylesheet" href="css/base.css">
        <link rel="stylesheet" href="css/layout.css">
        <script src="js/binding.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>

            var socketio = io()

            window.onload = function(){

                bind.hide( 'tweet' )

                var data = JSON.parse( sessionStorage.getItem( 'editList' ) )

                document.getElementById('rank').innerHTML = 'Rank ' + sessionStorage.getItem( 'editName' )
                sessionStorage.removeItem( 'editName' )

                bind.binding( 'tweet', data.response )
                
                bind.view( 'tweet' )
                
                document.getElementById( 'profileClose' ).addEventListener( 'click', function(){
                    document.getElementById( 'profileBackground' ).style.display = 'none'
                } )

            }
            
            socketio.on( 'processError', function( error ){
                if( typeof error.value == 'object' )
                    error.value = JSON.stringify( error.value )
                alert( 'エラーが発生しました．\n\n' + error.value )
            } )
            
            function getUserProfile( user ){
                console.log( user )
                socketio.emit( 'getUserProfile', {
                    value: user
                } )
            }
            
            var $ = function( e ){
                return document.getElementById( e )
            }
            
            socketio.on( 'gotUserProfile', function( profile ){
                
                profile = profile.value
                
                console.log( profile )
                $( 'profileBackground' ).style.display = 'block'
                $( 'profileImage' ).src = profile.profile_image_url
                $( 'profileName' ).innerHTML = profile.name
                $( 'profileScreenName' ).innerHTML = '@' + profile.screen_name
                $( 'profileId' ).innerHTML = profile.id
                $( 'profileDescription' ).innerHTML = profile.description
                $( 'profileFriends' ).innerHTML = 'Friends : ' + profile.friends_count + ' / Followers : ' + profile.followers_count
                $( 'profileCreatedAt' ).innerHTML = profile.created_at
                
            } )

        </script>
    </head>

    <body>

        <div id="application">

            <div id="nav">
                <div id="appName">SPOTLIGHT</div>
                <a href="/">
                    <div class="menu">メインページ</div>
                </a>
                <a href="/search">
                    <div class="menu">検索</div>
                </a>
                <a href="/list">
                    <div class="menu selected">ランク/リスト</div>
                </a>
                <a href="/setting">
                    <div class="menu">設定</div>
                </a>
            </div>

            <div id="article">
                <div id="header">
                    <div class="htext" id="rank"></div>
                </div>
                <div id="padding">

                    <div class="label">Result</div>

                    <div id="tweet">
                        <div class="tw clearfix" id="n{{id}}" rank="{{rank}}" onclick="getUserProfile( '{{screen_name}}' )">
                                <span class="userid">{{id}}</span>
                                <br>
                                <span class="username">{{name}}</span>
                                <span class="userscreenname">@{{screen_name}}</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            
            <div id="profileBackground">
                <div id="profileClose">閉じる</div>
                <div id="profileField">
                    <div id="profileId"></div><br><br>
                    <img src="" id="profileImage"><br><br>
                    <div id="profileName"></div>
                    <div id="profileScreenName"></div><br><br>
                    <div id="profileFriends"></div><br><br>
                    <div id="profileDescription"></div><br><br>
                    <div id="profileCreatedAt"></div>
                </div>
            </div>

        </div>

    </body>

</html>